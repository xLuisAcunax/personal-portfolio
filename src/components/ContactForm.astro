---
export interface Props { action: string } // URL de Formspree
const { action } = Astro.props;
---
<section id="contacto" class="mx-auto max-w-3xl px-6 py-24">
  <h2 class="text-2xl font-semibold mb-4 text-yellow-200">Contacto</h2>
  <p class="opacity-80 mb-6">¿Tienes un proyecto? Escríbeme y te respondo pronto.</p>

  <form id="contact-form" action={action} method="POST"
        class="space-y-4 rounded-2xl border border-neutral-800 bg-neutral-950 p-6">
    <!-- Honeypot anti-spam (invisible) -->
    <input type="text" name="_gotcha" class="hidden" tabindex="-1" autocomplete="off" />
    <!-- Asunto opcional -->
    <input type="hidden" name="_subject" value="Nuevo mensaje desde el portafolio" />

    <div>
      <label for="name" class="block text-sm opacity-80 mb-1">Nombre</label>
      <input id="name" name="name" type="text" required minlength="2"
             class="w-full rounded-lg bg-neutral-900 border border-neutral-800 px-3 py-2 outline-none focus:border-neutral-500" />
    </div>

    <div>
      <label for="email" class="block text-sm opacity-80 mb-1">Email</label>
      <input id="email" name="email" type="email" required
             class="w-full rounded-lg bg-neutral-900 border border-neutral-800 px-3 py-2 outline-none focus:border-neutral-500" />
    </div>

    <div>
      <label for="message" class="block text-sm opacity-80 mb-1">Mensaje</label>
      <textarea id="message" name="message" required minlength="10" rows="5"
                class="w-full rounded-lg bg-neutral-900 border border-neutral-800 px-3 py-2 outline-none focus:border-neutral-500"></textarea>
    </div>

    <div class="flex items-center gap-3">
      <button id="submit" type="submit"
              class="rounded-xl px-5 py-2.5 bg-white text-black font-medium hover:translate-y-[1px] transition disabled:opacity-50">
        Enviar
      </button>
      <span id="status" class="text-sm opacity-80" aria-live="polite"></span>
    </div>
  </form>

  <script type="module">
    // Progressive enhancement: si hay JS, enviamos por fetch sin recargar.
    const form = document.getElementById('contact-form');
    const submit = document.getElementById('submit');
    const status = document.getElementById('status');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const hp = form.querySelector('[name="_gotcha"]');
      if (hp && hp.value) return; // bot

      submit.disabled = true;
      status.textContent = 'Enviando…';

      try {
        const res = await fetch(form.action, {
          method: 'POST',
          body: new FormData(form),
          headers: { 'Accept': 'application/json' }
        });
        if (res.ok) {
          form.reset();
          status.textContent = '¡Gracias! Te responderé pronto.';
        } else {
          status.textContent = 'No se pudo enviar. Intenta de nuevo o escríbeme a tu-email@tu-dominio.';
        }
      } catch {
        status.textContent = 'Error de red. Reintenta en unos segundos.';
      } finally {
        submit.disabled = false;
      }
    });
  </script>

  <style is:global>
    @media (prefers-reduced-motion: reduce) {
      #submit { transition: none !important; }
    }
  </style>
</section>
