---
import { getCollection } from "astro:content";

const experience = await getCollection("experience");
const sortedExperience = experience.sort((a, b) => {
  const endA = a.data.end === "present" ? new Date().toISOString() : a.data.end || a.data.start;
  const endB = b.data.end === "present" ? new Date().toISOString() : b.data.end || b.data.start;
  return endB.localeCompare(endA);
});

const items = await Promise.all(sortedExperience.map(async (item) => {
  const { Content } = await item.render();
  return { ...item, Content };
}));
---

<section id="experience" class="py-20 border-t border-white/10">
  <div class="max-w-5xl mx-auto px-6">
    <h2 class="text-3xl font-bold mb-12 text-white">Experience</h2>

    <div class="relative border-l border-white/10 ml-3 space-y-12">
      {items.map((job) => (
        <div class="relative pl-8 group">
          {/* Dot on the line */}
          <div class="absolute -left-[5px] top-2 w-2.5 h-2.5 rounded-full bg-neutral-900 border border-neutral-600 group-hover:bg-blue-500 group-hover:border-blue-400 transition-colors shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
          
          <div class="flex flex-col sm:flex-row sm:items-baseline sm:justify-between mb-2">
            <h3 class="text-xl font-bold text-white group-hover:text-blue-400 transition-colors">
              {job.data.company}
            </h3>
            <span class="text-sm font-mono text-neutral-500">
              {job.data.start} â€” {job.data.end || "Present"}
            </span>
          </div>
          
          <div class="text-lg text-neutral-300 font-medium mb-4">{job.data.role}</div>
          
          <div class="prose prose-invert prose-sm text-neutral-400 max-w-none mb-4">
            <job.Content />
          </div>

          {job.data.stack && (
            <div class="flex flex-wrap gap-2">
              {job.data.stack.map(tech => (
                <span class="px-2 py-1 text-xs text-neutral-400 bg-white/5 border border-white/10 rounded">
                  {tech}
                </span>
              ))}
            </div>
          )}
        </div>
      ))}
    </div>
  </div>
</section>
